import{L as J}from"./LayoutSide-DlCohBD0.js";import{d as P,u as Q,r as w,c as W,a as X,b as Y,e as z,o as A,f as m,g as f,h as r,w as h,i as F,v as L,j as t,C as Z,t as $,k as i,E as U,l as C,m as N,F as T,n as B,p as ee,q as K,_ as te,s as R,x as O,y as j,z as ae,A as le,B as se,D as oe,G as ne,H as ie,I as E,J as ue,K as re}from"./index-Bh8kI-lX.js";const G=v=>(R("data-v-d1a19ca6"),v=v(),O(),v),de={class:"result-area"},ce={class:"result-header"},me=G(()=>t("h2",{style:{color:"var(--text-minor-color-h)",display:"inline-block"}},"搜索结果",-1)),ve={style:{"margin-left":"0.5em",color:"var(--text-minor-color-i)"}},pe={class:"result-container"},ge={class:"header"},fe={class:"title-container"},_e=["onClick"],he={class:"tag-list"},ye={class:"author"},ke=["onClick"],we={class:"summary"},Ve=G(()=>t("div",{class:"decoration"},null,-1)),xe=P({__name:"BlockResult",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(v,{expose:b}){const p=Q(),a=w([]),g=w(1),n=w("default"),_=W(()=>{const d=[],o=Math.max(g.value*20-20,0),e=Math.min(g.value*20,a.value.length);for(let c=o;c<e;c++)d.push(a.value[c]);return d}),V=X(),D=Y(),u=z(v,"modelValue");function l(d){var e;let o="";for(const c of d)o+=(((e=D.listTag[c])==null?void 0:e.name)||"")+"#";return o}const s=w(!1);async function I(){s.value=!0;const d=await V.readPostList();s.value=!1,a.value=[];for(const o in d){const e=d[o];if(u.value.board&&e.board!==u.value.board||u.value.time&&!(u.value.time[0]<=e.time&&e.time<=u.value.time[1]))continue;let c=!0;for(let k of u.value.tag)if(!e.tag.includes(k)){c=!1;break}if(c===!1)continue;let x=1;const M=e.title+"#"+e.auth+"#"+e.summary+"#"+l(e.tag);let S=0,q=-1;for(let k=0;k<M.length&&!(M[k]===u.value.keyword[S]&&(S++,k===q+1?x+=3:x+=1,q=k,S===u.value.keyword.length));k++);S===u.value.keyword.length&&a.value.push({weight:x/Math.sqrt(M.length+1),post:e})}n.value==="default"?a.value.sort((o,e)=>e.weight-o.weight):n.value==="time-old"?a.value.sort((o,e)=>o.post.time-e.post.time):n.value==="time-new"&&a.value.sort((o,e)=>e.post.time-o.post.time)}function H(){n.value==="default"?a.value.sort((d,o)=>o.weight-d.weight):n.value==="time-old"?a.value.sort((d,o)=>d.post.time-o.post.time):n.value==="time-new"&&a.value.sort((d,o)=>o.post.time-d.post.time)}return b({doSearch:I}),A(()=>{I()}),(d,o)=>(m(),f("div",de,[r(i(ee),{class:"result"},{default:h(()=>[F(t("div",null,[r(Z)],512),[[L,s.value]]),F(t("div",null,[t("div",ce,[t("div",null,[me,t("span",ve,"共 "+$(a.value.length)+" 条",1)]),t("div",null,[r(i(U),{placeholder:"排序方式",modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value=e),onChange:H,style:{width:"100px"}},{default:h(()=>[r(i(C),{label:"默认",value:"default"}),r(i(C),{label:"最新文章",value:"time-new"}),r(i(C),{label:"最旧文章",value:"time-old"})]),_:1},8,["modelValue"])])]),r(i(N),{total:a.value.length,"page-size":20,"current-page":g.value,"onUpdate:currentPage":o[1]||(o[1]=e=>g.value=e),layout:"prev, pager, next","hide-on-single-page":"",background:"",class:"pagination"},null,8,["total","current-page"]),t("div",pe,[(m(!0),f(T,null,B(_.value,({post:e})=>(m(),f("div",{class:"item",key:e.id},[t("div",ge,[t("div",fe,[t("span",{class:"title",onClick:c=>i(p).push("/article/"+e.id)},$(e.title),9,_e)]),t("div",he,[(m(!0),f(T,null,B(e.tag,c=>{var x;return m(),f("span",{class:"tag",key:c},$(((x=i(D).listTag[c])==null?void 0:x.name)||"未知标签"),1)}),128))]),t("div",ye,[K($(e.auth.name)+" / ",1),r(te,{date:new Date(e.time)},null,8,["date"])])]),t("div",{class:"summary-container",onClick:c=>i(p).push("/article/"+e.id)},[t("div",we,$(e.summary),1),Ve],8,ke)]))),128))]),r(i(N),{total:a.value.length,"page-size":20,"current-page":g.value,"onUpdate:currentPage":o[2]||(o[2]=e=>g.value=e),layout:"prev, pager, next","hide-on-single-page":"",background:"",class:"pagination"},null,8,["total","current-page"])],512),[[L,!s.value]])]),_:1})]))}}),be=j(xe,[["__scopeId","data-v-d1a19ca6"]]),y=v=>(R("data-v-e1ce794d"),v=v(),O(),v),$e={class:"aside"},Ce={class:"filter"},Te={class:"param"},Be=y(()=>t("h3",{class:"title"},"关键词",-1)),De=y(()=>t("p",{class:"explain"}," 将会从文章标题、作者、标签、摘要里进行匹配。 ",-1)),Se={class:"param"},Ee=y(()=>t("h3",{class:"title"},"标签",-1)),Ie=y(()=>t("p",{class:"explain"}," 将会匹配拥有所有标签的文章。 ",-1)),Me={class:"param"},Ue=y(()=>t("h3",{class:"title"},"类别",-1)),Pe=y(()=>t("p",{class:"explain"}," 将会匹配属于指定类别的文章。 ",-1)),qe={class:"param time"},Fe=y(()=>t("h3",{class:"title"},"时间",-1)),Le=y(()=>t("p",{class:"explain"}," 将会匹配起止时间之内的文章。 ",-1)),Ne={class:"confirm"},Ye=P({__name:"BlockFilter",props:{modelValue:{required:!0},modelModifiers:{}},emits:ae(["search"],["update:modelValue"]),setup(v,{emit:b}){const p=Y(),a=z(v,"modelValue"),g=b,n=w(void 0);function _(){n.value!==void 0&&(a.value.tag.includes(n.value)||a.value.tag.push(n.value),n.value=void 0)}function V(u){a.value.tag=a.value.tag.filter(l=>l!==u)}const D=[{text:"一个月内",value:()=>{const u=new Date,l=new Date;return l.setTime(l.getTime()-3600*1e3*24*30),[l,u]}},{text:"半年以内",value:()=>{const u=new Date,l=new Date;return l.setTime(l.getTime()-3600*1e3*24*180),[l,u]}},{text:"一年以内",value:()=>{const u=new Date,l=new Date;return l.setTime(l.getTime()-3600*1e3*24*365),[l,u]}}];return(u,l)=>(m(),f("aside",$e,[r(i(ie),{offset:25,target:".aside"},{default:h(()=>[t("section",Ce,[t("div",Te,[Be,r(i(le),{class:"input",modelValue:a.value.keyword,"onUpdate:modelValue":l[0]||(l[0]=s=>a.value.keyword=s),clearable:"",onKeydown:l[1]||(l[1]=se(s=>g("search"),["enter"]))},null,8,["modelValue"]),De]),t("div",Se,[Ee,(m(!0),f(T,null,B(a.value.tag,s=>(m(),E(ue,{key:s,tag:i(p).listTag[s],closeable:"",onClose:I=>V(s)},null,8,["tag","onClose"]))),128)),r(i(U),{modelValue:n.value,"onUpdate:modelValue":l[2]||(l[2]=s=>n.value=s),placeholder:"新增标签",onChange:_},{default:h(()=>[(m(!0),f(T,null,B(i(p).listTag,s=>(m(),E(i(C),{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ie]),t("div",Me,[Ue,r(i(U),{modelValue:a.value.board,"onUpdate:modelValue":l[3]||(l[3]=s=>a.value.board=s),placeholder:"选择类别",clearable:""},{default:h(()=>[(m(!0),f(T,null,B(i(p).listBoard,s=>(m(),E(i(C),{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Pe]),t("div",qe,[Fe,r(i(oe),{style:{width:"100%"},modelValue:a.value.time,"onUpdate:modelValue":l[4]||(l[4]=s=>a.value.time=s),type:"monthrange","unlink-panels":"","range-separator":"至","start-placeholder":"起始时间","end-placeholder":"终止时间",shortcuts:D,format:"YYYY/MM/DD","value-format":"x"},null,8,["modelValue"]),Le]),t("div",Ne,[r(i(ne),{onClick:l[5]||(l[5]=s=>g("search")),type:"primary",plain:""},{default:h(()=>[K("搜索")]),_:1})])])]),_:1})]))}}),ze=j(Ye,[["__scopeId","data-v-e1ce794d"]]),Re=P({__name:"BlogSearch",setup(v){const b=re(),p=w({keyword:"",tag:[],board:void 0,time:[0,1/0]}),a=w();return A(()=>{b.setTitle("文章检索 | 第三只眼")}),(g,n)=>(m(),E(J,{background:"purity"},{main:h(()=>[r(be,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=_=>p.value=_),ref_key:"engine",ref:a},null,8,["modelValue"])]),aside:h(()=>[r(ze,{modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=_=>p.value=_),onSearch:n[2]||(n[2]=_=>{var V;return(V=a.value)==null?void 0:V.doSearch()})},null,8,["modelValue"])]),_:1}))}});export{Re as default};
