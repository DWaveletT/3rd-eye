import{L as j}from"./LayoutSide-Dd0xBV5o.js";import{d as I,u as G,r as x,c as H,a as J,b as L,e as N,o as Y,f as m,g as _,h as r,w as h,i as l,t as $,j as i,E as U,k as C,l as F,F as T,m as B,n as Q,p as z,_ as W,q as A,s as R,v as K,x as X,y as Z,z as ee,A as te,B as ae,C as le,D as E,G as se,H as oe}from"./index-CDsDlu92.js";const O=v=>(A("data-v-a251deea"),v=v(),R(),v),ne={class:"result-area"},ie={class:"result-header"},ue=O(()=>l("h2",{style:{color:"var(--text-minor-color-h)",display:"inline-block"}},"搜索结果",-1)),re={style:{"margin-left":"0.5em",color:"var(--text-minor-color-i)"}},de={class:"result-container"},ce={class:"header"},me={class:"title-container"},ve=["onClick"],pe={class:"tag-list"},ge={class:"author"},_e=["onClick"],fe={class:"summary"},he=O(()=>l("div",{class:"decoration"},null,-1)),ke=I({__name:"BlockResult",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(v,{expose:b}){const p=G(),t=x([]),g=x(1),n=x("default"),f=H(()=>{const d=[],s=Math.max(g.value*20-20,0),e=Math.min(g.value*20,t.value.length);for(let c=s;c<e;c++)d.push(t.value[c]);return d}),w=J(),D=L(),u=N(v,"modelValue");function a(d){var e;let s="";for(const c of d)s+=(((e=D.listTag[c])==null?void 0:e.name)||"")+"#";return s}async function o(){const d=await w.readPostList();t.value=[];for(const s in d){const e=d[s];if(u.value.board&&e.board!==u.value.board||u.value.time&&!(u.value.time[0]<=e.time&&e.time<=u.value.time[1]))continue;let c=!0;for(let y of u.value.tag)if(!e.tag.includes(y)){c=!1;break}if(c===!1)continue;let V=1;const M=e.title+"#"+e.auth+"#"+e.summary+"#"+a(e.tag);let S=0,q=-1;for(let y=0;y<M.length&&!(M[y]===u.value.keyword[S]&&(S++,y===q+1?V+=3:V+=1,q=y,S===u.value.keyword.length));y++);S===u.value.keyword.length&&t.value.push({weight:V/Math.sqrt(M.length+1),post:e})}n.value==="default"?t.value.sort((s,e)=>e.weight-s.weight):n.value==="time-old"?t.value.sort((s,e)=>s.post.time-e.post.time):n.value==="time-new"&&t.value.sort((s,e)=>e.post.time-s.post.time)}function P(){n.value==="default"?t.value.sort((d,s)=>s.weight-d.weight):n.value==="time-old"?t.value.sort((d,s)=>d.post.time-s.post.time):n.value==="time-new"&&t.value.sort((d,s)=>s.post.time-d.post.time)}return b({doSearch:o}),Y(()=>{o()}),(d,s)=>(m(),_("div",ne,[r(i(Q),{class:"result"},{default:h(()=>[l("div",ie,[l("div",null,[ue,l("span",re,"共 "+$(t.value.length)+" 条",1)]),l("div",null,[r(i(U),{placeholder:"排序方式",modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=e=>n.value=e),onChange:P,style:{width:"100px"}},{default:h(()=>[r(i(C),{label:"默认",value:"default"}),r(i(C),{label:"最新文章",value:"time-new"}),r(i(C),{label:"最旧文章",value:"time-old"})]),_:1},8,["modelValue"])])]),r(i(F),{total:t.value.length,"page-size":20,"current-page":g.value,"onUpdate:currentPage":s[1]||(s[1]=e=>g.value=e),layout:"prev, pager, next","hide-on-single-page":"",background:"",class:"pagination"},null,8,["total","current-page"]),l("div",de,[(m(!0),_(T,null,B(f.value,({post:e})=>(m(),_("div",{class:"item",key:e.id},[l("div",ce,[l("div",me,[l("span",{class:"title",onClick:c=>i(p).push("/article/"+e.id)},$(e.title),9,ve)]),l("div",pe,[(m(!0),_(T,null,B(e.tag,c=>{var V;return m(),_("span",{class:"tag",key:c},$(((V=i(D).listTag[c])==null?void 0:V.name)||"未知标签"),1)}),128))]),l("div",ge,[z($(e.auth.name)+" / ",1),r(W,{date:new Date(e.time)},null,8,["date"])])]),l("div",{class:"summary-container",onClick:c=>i(p).push("/article/"+e.id)},[l("div",fe,$(e.summary),1),he],8,_e)]))),128))]),r(i(F),{total:t.value.length,"page-size":20,"current-page":g.value,"onUpdate:currentPage":s[2]||(s[2]=e=>g.value=e),layout:"prev, pager, next","hide-on-single-page":"",background:"",class:"pagination"},null,8,["total","current-page"])]),_:1})]))}}),ye=K(ke,[["__scopeId","data-v-a251deea"]]),k=v=>(A("data-v-e1ce794d"),v=v(),R(),v),we={class:"aside"},Ve={class:"filter"},xe={class:"param"},be=k(()=>l("h3",{class:"title"},"关键词",-1)),$e=k(()=>l("p",{class:"explain"}," 将会从文章标题、作者、标签、摘要里进行匹配。 ",-1)),Ce={class:"param"},Te=k(()=>l("h3",{class:"title"},"标签",-1)),Be=k(()=>l("p",{class:"explain"}," 将会匹配拥有所有标签的文章。 ",-1)),De={class:"param"},Se=k(()=>l("h3",{class:"title"},"类别",-1)),Ee=k(()=>l("p",{class:"explain"}," 将会匹配属于指定类别的文章。 ",-1)),Me={class:"param time"},Ue=k(()=>l("h3",{class:"title"},"时间",-1)),Ie=k(()=>l("p",{class:"explain"}," 将会匹配起止时间之内的文章。 ",-1)),Pe={class:"confirm"},qe=I({__name:"BlockFilter",props:{modelValue:{required:!0},modelModifiers:{}},emits:X(["search"],["update:modelValue"]),setup(v,{emit:b}){const p=L(),t=N(v,"modelValue"),g=b,n=x(void 0);function f(){n.value!==void 0&&(t.value.tag.includes(n.value)||t.value.tag.push(n.value),n.value=void 0)}function w(u){t.value.tag=t.value.tag.filter(a=>a!==u)}const D=[{text:"一个月内",value:()=>{const u=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*30),[a,u]}},{text:"半年以内",value:()=>{const u=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*180),[a,u]}},{text:"一年以内",value:()=>{const u=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*365),[a,u]}}];return(u,a)=>(m(),_("aside",we,[r(i(le),{offset:25,target:".aside"},{default:h(()=>[l("section",Ve,[l("div",xe,[be,r(i(Z),{class:"input",modelValue:t.value.keyword,"onUpdate:modelValue":a[0]||(a[0]=o=>t.value.keyword=o),clearable:"",onKeydown:a[1]||(a[1]=ee(o=>g("search"),["enter"]))},null,8,["modelValue"]),$e]),l("div",Ce,[Te,(m(!0),_(T,null,B(t.value.tag,o=>(m(),E(se,{key:o,tag:i(p).listTag[o],closeable:"",onClose:P=>w(o)},null,8,["tag","onClose"]))),128)),r(i(U),{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=o=>n.value=o),placeholder:"新增标签",onChange:f},{default:h(()=>[(m(!0),_(T,null,B(i(p).listTag,o=>(m(),E(i(C),{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Be]),l("div",De,[Se,r(i(U),{modelValue:t.value.board,"onUpdate:modelValue":a[3]||(a[3]=o=>t.value.board=o),placeholder:"选择类别",clearable:""},{default:h(()=>[(m(!0),_(T,null,B(i(p).listBoard,o=>(m(),E(i(C),{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ee]),l("div",Me,[Ue,r(i(te),{style:{width:"100%"},modelValue:t.value.time,"onUpdate:modelValue":a[4]||(a[4]=o=>t.value.time=o),type:"monthrange","unlink-panels":"","range-separator":"至","start-placeholder":"起始时间","end-placeholder":"终止时间",shortcuts:D,format:"YYYY/MM/DD","value-format":"x"},null,8,["modelValue"]),Ie]),l("div",Pe,[r(i(ae),{onClick:a[5]||(a[5]=o=>g("search")),type:"primary",plain:""},{default:h(()=>[z("搜索")]),_:1})])])]),_:1})]))}}),Fe=K(qe,[["__scopeId","data-v-e1ce794d"]]),Ye=I({__name:"BlogSearch",setup(v){const b=oe(),p=x({keyword:"",tag:[],board:void 0,time:[0,1/0]}),t=x();return Y(()=>{b.setTitle("文章检索 | 第三只眼")}),(g,n)=>(m(),E(j,{background:"purity"},{main:h(()=>[r(ye,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=f=>p.value=f),ref_key:"engine",ref:t},null,8,["modelValue"])]),aside:h(()=>[r(Fe,{modelValue:p.value,"onUpdate:modelValue":n[1]||(n[1]=f=>p.value=f),onSearch:n[2]||(n[2]=f=>{var w;return(w=t.value)==null?void 0:w.doSearch()})},null,8,["modelValue"])]),_:1}))}});export{Ye as default};
