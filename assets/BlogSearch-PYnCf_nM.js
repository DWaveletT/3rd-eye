import{L as O}from"./LayoutSide-CIXiBqzP.js";import{d as I,u as j,r as k,c as G,a as H,b as N,e as Y,o as z,f as m,g,h as r,w as _,i as q,v as F,j as l,C as J,t as b,k as i,E as S,l as x,m as L,F as C,n as T,p as Q,q as A,_ as W,s as R,x as X,y as Z,z as ee,A as te,B as le,D as ae,G as E,H as se,I as oe}from"./index-BWfRJ8CP.js";const ne={class:"result-area"},ie={class:"result-header"},ue={style:{"margin-left":"0.5em",color:"var(--text-minor-color-i)"}},re={class:"result-container"},de={class:"header"},ve={class:"title-container"},me=["onClick"],ce={class:"tag-list"},pe={class:"author"},ge=["onClick"],fe={class:"abstract"},_e=I({__name:"BlockResult",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup($,{expose:V}){const c=j(),s=k([]),p=k(1),n=k("default"),f=G(()=>{const d=[],a=Math.max(p.value*20-20,0),t=Math.min(p.value*20,s.value.length);for(let v=a;v<t;v++)d.push(s.value[v]);return d}),w=H(),B=N(),u=Y($,"modelValue");function e(d){var t;let a="";for(const v of d)a+=(((t=B.listTag[v])==null?void 0:t.name)||"")+"#";return a}const o=k(!1);async function M(){o.value=!0;const d=await w.readPostList();o.value=!1,s.value=[];for(const a in d){const t=d[a];if(u.value.board&&t.board!==u.value.board||u.value.time&&!(u.value.time[0]<=t.create_time&&t.create_time<=u.value.time[1]))continue;let v=!0;for(let h of u.value.tag)if(!t.tag.includes(h)){v=!1;break}if(v===!1)continue;let y=1;const U=t.title+"#"+t.author+"#"+t.abstract+"#"+e(t.tag);let D=0,P=-1;for(let h=0;h<U.length&&!(U[h]===u.value.keyword[D]&&(D++,h===P+1?y+=3:y+=1,P=h,D===u.value.keyword.length));h++);D===u.value.keyword.length&&s.value.push({weight:y/Math.sqrt(U.length+1),post:t})}n.value==="default"?s.value.sort((a,t)=>t.weight-a.weight):n.value==="time-old"?s.value.sort((a,t)=>a.post.create_time-t.post.create_time):n.value==="time-new"&&s.value.sort((a,t)=>t.post.create_time-a.post.create_time)}function K(){n.value==="default"?s.value.sort((d,a)=>a.weight-d.weight):n.value==="time-old"?s.value.sort((d,a)=>d.post.create_time-a.post.create_time):n.value==="time-new"&&s.value.sort((d,a)=>a.post.create_time-d.post.create_time)}return V({doSearch:M}),z(()=>{M()}),(d,a)=>(m(),g("div",ne,[r(i(Q),{class:"result"},{default:_(()=>[q(l("div",null,[r(J)],512),[[F,o.value]]),q(l("div",null,[l("div",ie,[l("div",null,[a[3]||(a[3]=l("h2",{style:{color:"var(--text-minor-color-h)",display:"inline-block"}},"搜索结果",-1)),l("span",ue,"共 "+b(s.value.length)+" 条",1)]),l("div",null,[r(i(S),{placeholder:"排序方式",modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=t=>n.value=t),onChange:K,style:{width:"100px"}},{default:_(()=>[r(i(x),{label:"默认",value:"default"}),r(i(x),{label:"最新文章",value:"time-new"}),r(i(x),{label:"最旧文章",value:"time-old"})]),_:1},8,["modelValue"])])]),r(i(L),{total:s.value.length,"page-size":20,"current-page":p.value,"onUpdate:currentPage":a[1]||(a[1]=t=>p.value=t),layout:"prev, pager, next","hide-on-single-page":"",background:"",class:"pagination"},null,8,["total","current-page"]),l("div",re,[(m(!0),g(C,null,T(f.value,({post:t})=>(m(),g("div",{class:"item",key:t.id},[l("div",de,[l("div",ve,[l("span",{class:"title",onClick:v=>i(c).push("/article/"+t.id)},b(t.title),9,me)]),l("div",ce,[(m(!0),g(C,null,T(t.tag,v=>{var y;return m(),g("span",{class:"tag",key:v},b(((y=i(B).listTag[v])==null?void 0:y.name)||"未知标签"),1)}),128))]),l("div",pe,[A(b(t.author.name)+" / ",1),r(W,{date:new Date(t.create_time)},null,8,["date"])])]),l("div",{class:"abstract-container",onClick:v=>i(c).push("/article/"+t.id)},[l("div",fe,b(t.abstract),1),a[4]||(a[4]=l("div",{class:"decoration"},null,-1))],8,ge)]))),128))]),r(i(L),{total:s.value.length,"page-size":20,"current-page":p.value,"onUpdate:currentPage":a[2]||(a[2]=t=>p.value=t),layout:"prev, pager, next","hide-on-single-page":"",background:"",class:"pagination"},null,8,["total","current-page"])],512),[[F,!o.value]])]),_:1})]))}}),he=R(_e,[["__scopeId","data-v-d22067a7"]]),ke={class:"aside"},we={class:"filter"},ye={class:"param"},Ve={class:"param"},be={class:"param"},xe={class:"param time"},Ce={class:"confirm"},Te=I({__name:"BlockFilter",props:{modelValue:{required:!0},modelModifiers:{}},emits:X(["search"],["update:modelValue"]),setup($,{emit:V}){const c=N(),s=Y($,"modelValue"),p=V,n=k(void 0);function f(){n.value!==void 0&&(s.value.tag.includes(n.value)||s.value.tag.push(n.value),n.value=void 0)}function w(u){s.value.tag=s.value.tag.filter(e=>e!==u)}const B=[{text:"一个月内",value:()=>{const u=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,u]}},{text:"半年以内",value:()=>{const u=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*180),[e,u]}},{text:"一年以内",value:()=>{const u=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*365),[e,u]}}];return(u,e)=>(m(),g("aside",ke,[r(i(ae),{offset:25,target:".aside"},{default:_(()=>[l("section",we,[l("div",ye,[e[6]||(e[6]=l("h3",{class:"title"},"关键词",-1)),r(i(Z),{class:"input",modelValue:s.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.keyword=o),clearable:"",onKeydown:e[1]||(e[1]=ee(o=>p("search"),["enter"]))},null,8,["modelValue"]),e[7]||(e[7]=l("p",{class:"explain"}," 将会从文章标题、作者、标签、摘要里进行匹配。 ",-1))]),l("div",Ve,[e[8]||(e[8]=l("h3",{class:"title"},"标签",-1)),(m(!0),g(C,null,T(s.value.tag,o=>(m(),E(se,{key:o,tag:i(c).listTag[o],closeable:"",onClose:M=>w(o)},null,8,["tag","onClose"]))),128)),r(i(S),{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value=o),placeholder:"新增标签",onChange:f},{default:_(()=>[(m(!0),g(C,null,T(i(c).listTag,o=>(m(),E(i(x),{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[9]||(e[9]=l("p",{class:"explain"}," 将会匹配拥有所有标签的文章。 ",-1))]),l("div",be,[e[10]||(e[10]=l("h3",{class:"title"},"类别",-1)),r(i(S),{modelValue:s.value.board,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.board=o),placeholder:"选择类别",clearable:""},{default:_(()=>[(m(!0),g(C,null,T(i(c).listBoard,o=>(m(),E(i(x),{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[11]||(e[11]=l("p",{class:"explain"}," 将会匹配属于指定类别的文章。 ",-1))]),l("div",xe,[e[12]||(e[12]=l("h3",{class:"title"},"时间",-1)),r(i(te),{style:{width:"100%"},modelValue:s.value.time,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.time=o),type:"monthrange","unlink-panels":"","range-separator":"至","start-placeholder":"起始时间","end-placeholder":"终止时间",shortcuts:B,format:"YYYY/MM/DD","value-format":"x"},null,8,["modelValue"]),e[13]||(e[13]=l("p",{class:"explain"}," 将会匹配起止时间之内的文章。 ",-1))]),l("div",Ce,[r(i(le),{onClick:e[5]||(e[5]=o=>p("search")),type:"primary",plain:""},{default:_(()=>e[14]||(e[14]=[A("搜索")])),_:1})])])]),_:1})]))}}),$e=R(Te,[["__scopeId","data-v-e1ce794d"]]),Ee=I({__name:"BlogSearch",setup($){const V=oe(),c=k({keyword:"",tag:[],board:void 0,time:[0,1/0]}),s=k();return z(()=>{V.setTitle("文章检索 | 第三只眼")}),(p,n)=>(m(),E(O,{background:"purity"},{main:_(()=>[r(he,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=f=>c.value=f),ref_key:"engine",ref:s},null,8,["modelValue"])]),aside:_(()=>[r($e,{modelValue:c.value,"onUpdate:modelValue":n[1]||(n[1]=f=>c.value=f),onSearch:n[2]||(n[2]=f=>{var w;return(w=s.value)==null?void 0:w.doSearch()})},null,8,["modelValue"])]),_:1}))}});export{Ee as default};
